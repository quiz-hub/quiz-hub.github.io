// Encrypted questions data (replace this with the actual encrypted string from the console)
const encryptedQuestions = "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";

// Decrypt function to retrieve the questions
function decryptQuestions(encryptedData) {
  const secretKey = "secretKey123"; // Same key used for encryption
  const bytes = CryptoJS.AES.decrypt(encryptedData, secretKey);
  return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
}

// Load and show the questions
let questions = decryptQuestions(encryptedQuestions);

// Initialize required variables
let currentQuestionIndex = 0; // Start from the first question
let score = 0; // Initialize score
let timeLeft = 0; // Time counter
let timer; // Timer variable
let username = ""; // User's name
let selectedAnswerIndex = Array(questions.length).fill(null); // Array to store selected answers for each question

// Show the current question
function showQuestion() {
  const question = questions[currentQuestionIndex];
  document.getElementById("question").textContent = question.question;
  const answersContainer = document.getElementById("answers");
  answersContainer.innerHTML = ""; // Clear previous answers

  question.answers.forEach((answer, index) => {
    const answerDiv = document.createElement("div");
    answerDiv.textContent = answer;
    answerDiv.onclick = () => selectAnswer(index);
    answersContainer.appendChild(answerDiv);
  });

  document.getElementById("question-num").textContent = `${currentQuestionIndex + 1}/10`;

  // If there's a selected answer, reapply the selection when going back to the question
  if (selectedAnswerIndex[currentQuestionIndex] !== null) {
    const answers = document.querySelectorAll('#answers div');
    answers[selectedAnswerIndex[currentQuestionIndex]].classList.add('selected');
  }

  // Disable Back button on the first question
  document.getElementById("prev-btn").disabled = currentQuestionIndex === 0;

  // Disable Next button if no answer selected
  document.getElementById("next-btn").disabled = selectedAnswerIndex[currentQuestionIndex] === null;
}

// Handle answer selection
function selectAnswer(index) {
  const answers = document.querySelectorAll('#answers div');
  answers.forEach(answer => answer.classList.remove('selected')); // Remove previous selection
  answers[index].classList.add('selected'); // Mark new selection
  selectedAnswerIndex[currentQuestionIndex] = index; // Store the selected answer index for this question
  document.getElementById("next-btn").disabled = false; // Enable Next button
}

// Calculate the score
function calculateScore() {
  let currentScore = 0;
  questions.forEach((question, index) => {
    if (selectedAnswerIndex[index] !== null && selectedAnswerIndex[index] === question.correctAnswer) {
      currentScore++; // Increase score if the selected answer is correct
    }
  });
  return currentScore;
}

// Check answer and update score
function checkAnswer() {
  score = calculateScore(); // Recalculate score every time an answer is checked
  document.getElementById("next-btn").disabled = false;
}

// Show the final result
function showResult() {
  clearInterval(timer); // Stop the timer when the quiz is finished
  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";
  // document.getElementById("user-info").style.display = "block";

  document.getElementById("final-score").textContent = score;
  document.getElementById("final-time").textContent = timeLeft;
}

// Timer - count upwards from 0
function startTimer() {
  timer = setInterval(() => {
    timeLeft++;
    document.getElementById("time").textContent = timeLeft;

    if (currentQuestionIndex >= questions.length) {
      showResult();
    }
  }, 1000);
}

// // Save score only if username is provided
// function saveScore() {
//   if (username.trim() === "") {
//     alert("Please enter your name before saving the score.");
//     return;
//   }

//   const scoreData = {
//     username: username,
//     score: score,
//     time: timeLeft,
//   };

//   const encryptedData = CryptoJS.AES.encrypt(JSON.stringify(scoreData), "secretKey123").toString();

//   const blob = new Blob([encryptedData], { type: 'application/json' });
//   const link = document.createElement("a");
//   link.href = URL.createObjectURL(blob);
//   link.download = "highscore.json";
//   link.click();
// }

// Event Listeners
document.getElementById("next-btn").addEventListener("click", () => {
  checkAnswer();
  currentQuestionIndex++;
  if (currentQuestionIndex < questions.length) {
    showQuestion();
  } else {
    showResult();
  }
  document.getElementById("next-btn").disabled = true;
});

document.getElementById("prev-btn").addEventListener("click", () => {
  currentQuestionIndex--;
  showQuestion();
  document.getElementById("prev-btn").disabled = currentQuestionIndex === 0;
  document.getElementById("next-btn").disabled = false;
});

// document.getElementById("save-score-btn").addEventListener("click", saveScore);

document.getElementById("username").addEventListener("input", (event) => {
  username = event.target.value;
});

// Initialize quiz
showQuestion();
startTimer();




