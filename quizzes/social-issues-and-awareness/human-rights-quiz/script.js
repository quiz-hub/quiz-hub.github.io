// Encrypted questions data (replace this with the actual encrypted string from the console)
const encryptedQuestions = "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";

// Decrypt function to retrieve the questions
function decryptQuestions(encryptedData) {
  const secretKey = "secretKey123"; // Same key used for encryption
  const bytes = CryptoJS.AES.decrypt(encryptedData, secretKey);
  return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
}

// Load and show the questions
let questions = decryptQuestions(encryptedQuestions);

// Initialize required variables
let currentQuestionIndex = 0; // Start from the first question
let score = 0; // Initialize score
let timeLeft = 0; // Time counter
let timer; // Timer variable
let username = ""; // User's name
let selectedAnswerIndex = Array(questions.length).fill(null); // Array to store selected answers for each question

// Show the current question
function showQuestion() {
  const question = questions[currentQuestionIndex];
  document.getElementById("question").textContent = question.question;
  const answersContainer = document.getElementById("answers");
  answersContainer.innerHTML = ""; // Clear previous answers

  question.answers.forEach((answer, index) => {
    const answerDiv = document.createElement("div");
    answerDiv.textContent = answer;
    answerDiv.onclick = () => selectAnswer(index);
    answersContainer.appendChild(answerDiv);
  });

  document.getElementById("question-num").textContent = `${currentQuestionIndex + 1}/10`;

  // If there's a selected answer, reapply the selection when going back to the question
  if (selectedAnswerIndex[currentQuestionIndex] !== null) {
    const answers = document.querySelectorAll('#answers div');
    answers[selectedAnswerIndex[currentQuestionIndex]].classList.add('selected');
  }

  // Disable Back button on the first question
  document.getElementById("prev-btn").disabled = currentQuestionIndex === 0;

  // Disable Next button if no answer selected
  document.getElementById("next-btn").disabled = selectedAnswerIndex[currentQuestionIndex] === null;
}

// Handle answer selection
function selectAnswer(index) {
  const answers = document.querySelectorAll('#answers div');
  answers.forEach(answer => answer.classList.remove('selected')); // Remove previous selection
  answers[index].classList.add('selected'); // Mark new selection
  selectedAnswerIndex[currentQuestionIndex] = index; // Store the selected answer index for this question
  document.getElementById("next-btn").disabled = false; // Enable Next button
}

// Calculate the score
function calculateScore() {
  let currentScore = 0;
  questions.forEach((question, index) => {
    if (selectedAnswerIndex[index] !== null && selectedAnswerIndex[index] === question.correctAnswer) {
      currentScore++; // Increase score if the selected answer is correct
    }
  });
  return currentScore;
}

// Check answer and update score
function checkAnswer() {
  score = calculateScore(); // Recalculate score every time an answer is checked
  document.getElementById("next-btn").disabled = false;
}

// Show the final result
function showResult() {
  clearInterval(timer); // Stop the timer when the quiz is finished
  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";
  // document.getElementById("user-info").style.display = "block";

  document.getElementById("final-score").textContent = score;
  document.getElementById("final-time").textContent = timeLeft;
}

// Timer - count upwards from 0
function startTimer() {
  timer = setInterval(() => {
    timeLeft++;
    document.getElementById("time").textContent = timeLeft;

    if (currentQuestionIndex >= questions.length) {
      showResult();
    }
  }, 1000);
}

// // Save score only if username is provided
// function saveScore() {
//   if (username.trim() === "") {
//     alert("Please enter your name before saving the score.");
//     return;
//   }

//   const scoreData = {
//     username: username,
//     score: score,
//     time: timeLeft,
//   };

//   const encryptedData = CryptoJS.AES.encrypt(JSON.stringify(scoreData), "secretKey123").toString();

//   const blob = new Blob([encryptedData], { type: 'application/json' });
//   const link = document.createElement("a");
//   link.href = URL.createObjectURL(blob);
//   link.download = "highscore.json";
//   link.click();
// }

// Event Listeners
document.getElementById("next-btn").addEventListener("click", () => {
  checkAnswer();
  currentQuestionIndex++;
  if (currentQuestionIndex < questions.length) {
    showQuestion();
  } else {
    showResult();
  }
  document.getElementById("next-btn").disabled = true;
});

document.getElementById("prev-btn").addEventListener("click", () => {
  currentQuestionIndex--;
  showQuestion();
  document.getElementById("prev-btn").disabled = currentQuestionIndex === 0;
  document.getElementById("next-btn").disabled = false;
});

// document.getElementById("save-score-btn").addEventListener("click", saveScore);

document.getElementById("username").addEventListener("input", (event) => {
  username = event.target.value;
});

// Initialize quiz
showQuestion();
startTimer();




